<!--
TODO авторизация
TODO photo feed
TODO Celery Redis на получение данных
TODO Secure your API keys
TODO описание для Git
TODO описание API
TODO deploy to Heroku
-->
{% load static %}
<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="caravan4eg" />

	<!-- Stylesheets
	============================================= -->
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Raleway:300,400,500,600,700|Crete+Round:400i" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="{% static 'css/bootstrap.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/style.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/dark.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/font-icons.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/animate.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %} " type="text/css" />


	<link rel="stylesheet" href="{% static 'css/responsive.css' %} " type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- Medical Demo Specific Stylesheet -->
		<link rel="stylesheet" href="{% static 'css/animate.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %} " type="text/css" />

	<link rel="stylesheet" href="{% static 'medical/fonts.css' %} " type="text/css" /><link rel="stylesheet" href="{% static 'medical/medical.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/swiper.css' %} " type="text/css" />

	<!-- Document Title
	============================================= -->
	<title>covidMonitor - Пандемия covid-19 в Беларуси {% block title %} {% endblock title %}
	</title>

	<style>
		.form-control.error { border: 2px solid red; }
	</style>
</head>

<body class="stretched" data-loader-html="<div id='css3-spinner-svg-pulse-wrapper'><svg id='css3-spinner-svg-pulse' version='1.2' height='210' width='550' xmlns='http://www.w3.org/2000/svg' viewport='0 0 60 60' xmlns:xlink='http://www.w3.org/1999/xlink'><path id='css3-spinner-pulse' stroke='#DE6262' fill='none' stroke-width='2' stroke-linejoin='round' d='M0,90L250,90Q257,60 262,87T267,95 270,88 273,92t6,35 7,-60T290,127 297,107s2,-11 10,-10 1,1 8,-10T319,95c6,4 8,-6 10,-17s2,10 9,11h210' /></svg></div>">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">
		<!-- Top Bar
		============================================= -->
		{% include 'partials/_topbar.html' %}
		<!-- Header
		============================================= -->
		{% include 'partials/_navbar.html' %}

		<!-- Slider
		============================================= -->
		<section id="slider" class="slider-element swiper_wrapper full-screen clearfix" data-loop="true" data-autoplay="5000">

			<div class="swiper-container swiper-parent">
				<div class="swiper-wrapper">
					<div class="swiper-slide" style="background-image: url('{% static 'medical/images/slider/1.jpg' %} ');">
						<div class="container clearfix">
							<div class="slider-caption slider-caption-right" style="max-width: 700px;">
								<h2 data-animate="flipInX">COVID-19 Монитор<span>.</span></h2>
								<p class="d-none d-sm-block" data-animate="flipInX" data-delay="500">Развитие пандемии в Беларуси<br> Статитика, факты, новости<br>
								Проекты в поддержку врачей и пострадавших</p>
							</div>
						</div>
					</div>
					{% comment %} {% static 'medical/images/slider/2.jpg' %} {% endcomment %}
					<div class="swiper-slide" style="background-image: url('{% static 'medical/images/slider/2.jpg' %} ');">
						<div class="container clearfix">
							<div class="slider-caption slider-caption-right">
							<br>
							<br>
							<br>
							<br>
							<br>
							<br>
							<br>
								<h2 data-animate="zoomIn">берегите<span>себя</span>.</h2>
								<p class="d-none d-sm-block" data-animate="zoomIn" data-delay="500">Соблюдайте меры предосторожности!<br>
								Держите социальную дистанцию!<br>
								Отавайтесь дома!</p>

							</div>
						</div>
					</div>
				</div>
			</div>
		</section><!-- #slider end -->

		<!-- Facts banner start
		============================================= -->
				<div id="covid"></div>
				<div class="section notopmargin nobottommargin">
					<div class="container clearfix">

						<div class="row">
							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus" target="_blank"><i class="icon-stack i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="1" data-to=" {{ last_d }}" data-refresh-interval="250" data-speed="2000"></span></div>
									<h5 class="nomargin color">{{last_d}}/{{last_m}}/{{last_y}}</h5>
									<div class="d-block d-md-block d-lg-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><i class="icon-tint i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.confirmed }}" data-refresh-interval="250" data-speed="2000"></span>+</div>
									<h5 class="nomargin color">Количество заболевших</h5>
									<div class="d-block d-md-block d-lg-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus" target="_blank"><i class="icon-tint i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.recovered }}" data-refresh-interval="5" data-speed="3000"></span>+</div>
									<h5 class="nomargin color">Количество выздоровевших</h5>
									<div class="d-block d-md-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus" target="_blank"><i class="icon-text-width i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.deaths }}" data-refresh-interval="110" data-speed="3500"></span>+</div>
									<h5 class="nomargin color">Количество умерших</h5>
								</div>
							</div>
						</div>

					</div>
				</div>
		<!-- Facts banner end
		============================================= -->

		<!-- Content
		============================================= -->
		<section id="content">
			<div class="content-wrap">
				<div class="container clearfix animate-me">

					<div class="fancy-title title-border">
						<h3>Статистика по дням</h3>
					</div>
					<div class="row bottommargin-sm clearfix">
					<!-- Charts start
					============================================= -->
						<div class="bottommargin col-lg-8 " style="max-width: 750px; min-height: 350px;">
							<canvas id="chart-0"></canvas>
						</div>

					<!-- Charts end
					============================================= -->
					<div class="col-lg-4 bottommargin">
						<!--Flickr photofeed -->
						<div class="widget clearfix">
							<h4>Пандемия в лицах</h4>
							<div id="flickr-widget" class="flickr-feed masonry-thumbs" data-id="188236970@N04" data-count="16" data-type="user" data-lightbox="gallery"></div>
						</div>
					</div>
				</div>
			</div>

			<div class="clear"></div>
				<div class="container clearfix">
					<div class="fancy-title title-border">
						<h3>Уровень заболеваемости по областям</h3>
					</div>
					<div class="row bottommargin-sm clearfix">

						<div class="col-lg-8 bottommargin">

							<div class="ipost clearfix">
								<div class="entry-image">
									<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus" title="Уровень заболеваемости по областям Беларуси" target="_blank"><img class="image_fade" src="{% static '/images/magazine/COVID-19_Cases_in_Belarus,_13.03.2020 (1).png' %} " alt="2020_coronavirus_pandemic_in_Belarus"></a>
								</div>
								<!-- legenda start -->
								<div style="text-align:justify2;">Подтвержденные случаи covid-19:
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #510000; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;&gt;2000 подтвержденных случаев
									</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #900000; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;1000–1999 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #c80200; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;500–999 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #ee7070; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;200–499 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #ffc0c0; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;1–199 подтвержденных случаев</div></div>

								<!-- legenda end -->
							</div>
						</div>
					<!-- News right site -->
						<div class="col-lg-4 bottommargin">

						{% if posts8 %}
							{% for post in posts8  %}
							<div class="spost clearfix">
								<div class="entry-image">
									<a href="{{ post.url }}" target="_blank">
									<img src="
									{% if post.img_url %}
										{{post.img_url }}
									{% else %}
										{{ post.img.url }}
									{% endif %}
									" alt="img"></a>
								</div>
								<div class="entry-c">
									<div class="entry-title">
										<h4><a href="{{ post.url }}" target="_blank">{{ post.title }} </a></h4>
									</div>
									<ul class="entry-meta">
										<li><i class="icon-calendar3"></i> {{ post.published_at | date:"j E Y" }}</li>
									</ul>
								</div>
							</div>
							{% endfor %}
						{% endif %}

						</div>

					</div>
				</div>

				<div class="clear"></div>

				<div class="clear"></div>

				<!-- Section Projects
				=============================================-->
				<div id="projects"></div>
				<div class="container clearfix">

					<div class="col_full bottommargin-lg clearfix">

						<div class="fancy-title title-border">
							<h3>Проекты по поддержке врачей и заболевших </h3>
						</div>
						{% for project in projects8 %}
							<div
								{% if forloop.counter == 4 or forloop.counter == 8 %}
									class="col_one_fourth col_last"
								{% else %}
									class="col_one_fourth"
								{% endif %}
								>
								<div class="ipost clearfix">
									<div class="entry-image">
										<a href="{{ project.url }}" target="_blank"><img class="image_fade" src="{{ project.img.url }} " alt="{{ project.title }}" title="{{ project.title }}"></a>
									</div>

									<div class="entry-title">
										<h3><a href="{{ project.url }}" target="_blank">{{ project.short_description | truncatechars:99}}</a></h3>
									</div>
									<ul class="entry-meta clearfix">
										<li><a href="{{ project.url }}" target="_blank"><i class="icon-comments"></i> {{ project.title }}</a></li>
									</ul>
									<div class="entry-content">
										<p>{{ project.description | truncatechars:220 }}</p>
									</div>
								</div>
							</div>
							{% if forloop.counter == 4  %}
								<div class="clear"></div>
							{% endif %}
						{% endfor %}

					</div>
				<!-- Section Projects end
				=============================================-->


					</div>
				</div>



			</div>
		</section><!-- #content end -->

		<!-- Footer start -->
    	{% include 'partials/_footer.html' %}
		<!-- Footer end -->

	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

	<!-- External JavaScripts
	============================================= -->
	<script src="{% static 'js/jquery.js' %} "></script>
	<script src="{% static 'js/plugins.js' %} "></script>

	<!-- Footer Scripts
	============================================= -->
	<script src="{% static 'js/functions.js' %} "></script>

<!-- Charts JS
	============================================= -->
	<script src="{% static 'js/chart.js' %} "></script>
	<script src="{% static 'js/chart-utils.js' %} "></script>
	<script src="{% static 'js/components/moment.js' %} "></script>

	<script>
		var endpoint = '/api/v1/facts/'
		var published_at = []
		var confirmed = []
		var recovered = []
		var deaths = []

		$.ajax({
			method: "GET",
			url: endpoint,
			success: function(data){
				for(var i=data.length-30; i < data.length; i++){
					d = new Date(data[i].published_at)
					published_at.unshift(d)
					confirmed.unshift(data[i].confirmed)
					recovered.unshift(data[i].recovered)
					deaths.unshift(data[i].deaths)
				}
				console.log(published_at);


			},
			error: function(error_data){
				console.log("error")
				console.log(error_data)
			}
		})

		var timeFormat = 'DD/MM';

		function newDate(days) {
			return moment().add(days, 'd').toDate();
		}

		function newDateString(days) {
			return moment().add(days, 'd').format(timeFormat);
		}

		function newTimestamp(days) {
			return moment().add(days, 'd').unix();
		}

		var color = Chart.helpers.color;
		var config = {
			type: 'line',
			data: {
				labels: published_at,
				datasets:
				[
					{
					label: "Заболели",
					backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
					borderColor: window.chartColors.red,
					fill: false,
					data: confirmed,
				},
				{
					label: "Выздоровели",
					backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
					borderColor: window.chartColors.green,
					fill: false,
					data: recovered,
				},
				{
					label: "Умерли",
					backgroundColor: color(window.chartColors.black).alpha(0.5).rgbString(),
					borderColor: window.chartColors.black,
					fill: false,
					data: deaths,
				}]
			},
			options: {
				title:{
					text: "Статистика COVID-19 в Беларуси"
				},
				scales: {
					xAxes: [{
						type: "time",
						time: {
							format: timeFormat,
							// round: 'day'
							tooltipFormat: 'DD/MM'
						},
						scaleLabel: {
							display: false,
							labelString: 'Дата'
						}
					}, ],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Количество'
						}
					}]
				},
			}
		};
		const myChart = document.querySelectorAll('.animate-me');

		observer = new IntersectionObserver(entries => {
		entries.forEach(entry => {
			if (entry.intersectionRatio > 0) {
			console.log('in the view');
			var ctx = document.getElementById("chart-0").getContext("2d");
			window.myLine = new Chart(ctx, config);

			} else {
			console.log('out of view');
			}
		});
		});

		myChart.forEach(image => {
		observer.observe(image);
		});
	</script>
</body>
</html>
