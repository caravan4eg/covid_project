<!-- TODO графики рисовать -->
<!--TODO нормальный парсинг статей и данных-->
{% load static %}
<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="author" content="caravan4eg" />

	<!-- Stylesheets
	============================================= -->
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,400i,700|Raleway:300,400,500,600,700|Crete+Round:400i" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="{% static 'css/bootstrap.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/style.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/dark.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/font-icons.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/animate.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %} " type="text/css" />


	<link rel="stylesheet" href="{% static 'css/responsive.css' %} " type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<!-- Medical Demo Specific Stylesheet -->
		<link rel="stylesheet" href="{% static 'css/animate.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'css/magnific-popup.css' %} " type="text/css" />

	<link rel="stylesheet" href="{% static 'medical/fonts.css' %} " type="text/css" /><link rel="stylesheet" href="{% static 'medical/medical.css' %} " type="text/css" />
	<link rel="stylesheet" href="{% static 'css/swiper.css' %} " type="text/css" />
	<!--custom css-->
	{% comment %} <link rel="stylesheet" href="{% static 'css/custom.css' %} " type="text/css" /> {% endcomment %}
	<!-- / -->

	<!-- Document Title
	============================================= -->
	<title>COVID-19 monitor | Belarus</title>

	<style>
		.form-control.error { border: 2px solid red; }
	</style>

</head>

<body class="stretched">

	<!-- Document Wrapper
	============================================= -->
	<div id="wrapper" class="clearfix">

		<!-- Top Bar
		============================================= -->
		<div id="top-bar">

			<div class="container clearfix">

				<div class="col_half nobottommargin">

					<!-- Top Links
					============================================= -->
					<div class="top-links">
						<ul>
							<li><a href="{% url 'home' %}">Home</a></li>
							<li><a href="faqs.html">FAQs</a></li>
							<li><a href="contact.html">Contact</a></li>

						</ul>
					</div><!-- .top-links end -->

				</div>

				<div class="col_half fright col_last nobottommargin">

					<!-- Top Social
					============================================= -->
					<div id="top-social">
						<ul>
							<li><a href="#" class="si-facebook"><span class="ts-icon"><i class="icon-facebook"></i></span><span class="ts-text">Facebook</span></a></li>
							<li><a href="#" class="si-github"><span class="ts-icon"><i class="icon-github-circled"></i></span><span class="ts-text">Github</span></a></li>
							<li><a href="#" class="si-instagram"><span class="ts-icon"><i class="icon-instagram2"></i></span><span class="ts-text">Instagram</span></a></li>

							<li><a href="mailto:covidmonitor@gmail.com" class="si-email3"><span class="ts-icon"><i class="icon-email3"></i></span><span class="ts-text">covidmonitor@gmail.com</span></a></li>
						</ul>
					</div><!-- #top-social end -->

				</div>

			</div>

		</div><!-- #top-bar end -->

		<!-- Header
		============================================= -->
		<header id="header">

			<div id="header-wrap">

				<div class="container clearfix">

					<div id="primary-menu-trigger"><i class="icon-reorder"></i></div>

					<!-- Logo
					============================================= -->
					<div id="logo">
						<a href="index.html" class="standard-logo"><img src="{% static 'medical/images/logo-medical.png' %} " alt="Logo"></a>
						<a href="{% url 'home' %} " class="retina-logo"><img src="{% static 'medical/images/logo-medical@2x.png' %} " alt=" Logo"></a>
					</div><!-- #logo end -->

					<!-- Primary Navigation
					============================================= -->
					<nav id="primary-menu" class="style-3">

						<ul>
							<li class="current"><a href="{% url 'home' %} "><div>Главная</div></a></li>
							<li><a href="demos/medical/about-us.html"><div>Новости</div></a></li>
							<li><a href="demos/medical/departments.html"><div>Проекты</div></a></li>
							<li><a href="demos/medical/blog.html"><div>Коронавирус</div></a></li>
							<li><a href="./api/v1"><div>API</div></a></li>
							<li><a href="./api/v1"><div>О нас</div></a></li>

						</ul>

					</nav><!-- #primary-menu end -->

				</div>

			</div>

		</header><!-- #header end -->

		<!-- Slider
		============================================= -->
		<section id="slider" class="slider-element swiper_wrapper full-screen clearfix" data-loop="true" data-autoplay="5000">

			<div class="swiper-container swiper-parent">
				<div class="swiper-wrapper">
					<div class="swiper-slide" style="background-image: url('{% static 'medical/images/slider/1.jpg' %} ');">
						<div class="container clearfix">
							<div class="slider-caption slider-caption-right" style="max-width: 700px;">
								<h2 data-animate="flipInX">COVID-19 Монитор<span>.</span></h2>
								<p class="d-none d-sm-block" data-animate="flipInX" data-delay="500">Развитие пандемии в Беларуси<br> Статитика, факты, новости<br>
								Проекты в поддержку врачей и пострадавших</p>
							</div>
						</div>
					</div>
					{% comment %} {% static 'medical/images/slider/2.jpg' %} {% endcomment %}
					<div class="swiper-slide" style="background-image: url('{% static 'medical/images/slider/2.jpg' %} ');">
						<div class="container clearfix">
							<div class="slider-caption slider-caption-right">
							<br>
							<br>
							<br>
							<br>
							<br>
							<br>
							<br>
								<h2 data-animate="zoomIn">берегите<span>себя</span>.</h2>
								<p class="d-none d-sm-block" data-animate="zoomIn" data-delay="500">Соблюдайте меры предосторожности!<br>
								Держите социальную дистанцию!<br>
								Отавайтесь дома!</p>

							</div>
						</div>
					</div>
				</div>
			</div>
		</section><!-- #slider end -->

		<!--цифры начало
		========================================================= -->
				<div class="section notopmargin nobottommargin">
					<div class="container clearfix">

						<div class="row">
							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><i class="icon-stack i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="1" data-to=" {{ last_d }}" data-refresh-interval="250" data-speed="2000"></span></div>
									<h5 class="nomargin color">{{last_d}}/{{last_m}}/{{last_y}}</h5>
									<div class="d-block d-md-block d-lg-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><i class="icon-tint i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.confirmed }}" data-refresh-interval="250" data-speed="2000"></span>+</div>
									<h5 class="nomargin color">Количество заболевших</h5>
									<div class="d-block d-md-block d-lg-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><i class="icon-tint i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.recovered }}" data-refresh-interval="5" data-speed="3000"></span>+</div>
									<h5 class="nomargin color">Количество выздоровевших</h5>
									<div class="d-block d-md-none bottommargin"></div>
								</div>
							</div>

							<div class="col-lg-3 col-md-6">
								<div class="feature-box fbox-outline fbox-dark fbox-effect clearfix">
									<div class="fbox-icon">
										<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><i class="icon-text-width i-alt"></i></a>
									</div>
									<div class="counter counter-small"><span data-from="100" data-to="{{ facts_last.deaths }}" data-refresh-interval="110" data-speed="3500"></span>+</div>
									<h5 class="nomargin color">Количество умерших</h5>
								</div>
							</div>
						</div>

					</div>
				</div>
		<!--цифры конец

		<!-- Content
		============================================= -->
		<section id="content">
			<div class="content-wrap">
				<div class="clear"></div>
				<div class="container clearfix">
					<div class="fancy-title title-border">
						<h3>Уровень заболеваемости по областям</h3>
					</div>
					<div class="row bottommargin-sm clearfix">

						<div class="col-lg-8 bottommargin">

							<div class="ipost clearfix">
								<div class="entry-image">
									<a href="https://en.wikipedia.org/wiki/2020_coronavirus_pandemic_in_Belarus"><img class="image_fade" src="{% static '/images/magazine/COVID-19_Cases_in_Belarus,_13.03.2020 (1).png' %} " alt="2020_coronavirus_pandemic_in_Belarus"></a>
								</div>
								<!-- legenda start -->
								<div style="text-align:justify2;">Подтвержденные случаи covid-19:
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #510000; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;&gt;2000 подтвержденных случаев
									</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #900000; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;1000–1999 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #c80200; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;500–999 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #ee7070; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;200–499 подтвержденных случаев</div>
									<div class="legend" style="-webkit-column-break-inside: avoid;page-break-inside: avoid;break-inside: avoid-column"><span class="legend-color" style="display:inline-block; width:1.5em; height:1.5em; margin:1px 0; border:1px solid black; background-color: #ffc0c0; color:black; font-size:100%; text-align:center;">&nbsp;</span>&nbsp;1–199 подтвержденных случаев</div></div>

								<!-- legenda end -->
							</div>
						</div>
					<!-- News right site -->
						<div class="col-lg-4 bottommargin">
						{% if posts8 %}
							{% for post in posts8  %}
							<div class="spost clearfix">
								<div class="entry-image">
									<a href="{{ post.url }}" target="_blank">
									<img src="
									{% if post.img_url %}
										{{post.img_url }}
									{% else %}
										{{ post.img.url }}
									{% endif %}
									" alt="img"></a>
								</div>
								<div class="entry-c">
									<div class="entry-title">
										<h4><a href="{{ post.url }}" target="_blank">{{ post.title }} </a></h4>
									</div>
									<ul class="entry-meta">
										<li><i class="icon-calendar3"></i> {{ post.published_at | date:"j E Y" }}</li>
									</ul>
								</div>
							</div>
							{% endfor %}
						{% endif %}
						</div>
					</div>
				</div>

				<div class="clear"></div>

				<div class="container clearfix">

					<div class="fancy-title title-border">
						<h3>Статистика по дням</h3>
					</div>
					<!-- New Charts Area
					============================================= -->
					<div class="bottommargin col-lg-12 divcenter animate-me" style="max-width: 750px; min-height: 350px;">
						<canvas id="chart-0"></canvas>
					</div>

					<!-- New Charts Area
					============================================= -->
				</div>

				<!-- Section Projects
				=============================================-->
				<div class="container clearfix">

					<div class="col_full bottommargin-lg clearfix">

						<div class="fancy-title title-border">
							<h3>Проекты по поддержке врачей и заболевших </h3>
						</div>
						{% for project in projects8 %}
							<div
								{% if forloop.counter == 4 or forloop.counter == 8 %}
									class="col_one_fourth col_last"
								{% else %}
									class="col_one_fourth"
								{% endif %}
								>
								<div class="ipost clearfix">
									<div class="entry-image">
										<a href="{{ project.url }}" target="_blank"><img class="image_fade" src="{{ project.img.url }} " alt="Image"></a>
									</div>

									<div class="entry-title">
										<h3><a href="{{ project.url }}" target="_blank">{{ project.short_description | truncatechars:99}}</a></h3>
									</div>
									<ul class="entry-meta clearfix">
										<li><a href="{{ project.url }}" target="_blank"><i class="icon-comments"></i> {{ project.title }}</a></li>
									</ul>
									<div class="entry-content">
										<p>{{ project.description | truncatechars:220 }}</p>
									</div>
								</div>
							</div>
							{% if forloop.counter == 4  %}
								<div class="clear"></div>
							{% endif %}
						{% endfor %}

					</div>
				<!-- Section Projects end
				=============================================-->
					</div>
				</div>
			</div>
		</section><!-- #content end -->

		<!-- Footer
		============================================= -->
		<footer id="footer" class="dark">
			<div class="container">
				<!-- Footer Widgets
				============================================= -->
				<div class="footer-widgets-wrap clearfix">
					<div class="col_two_third">
						<div class="col_one_third">
							<div class="widget clearfix">
								<p><strong>Приведенные данные  могут не учитывать последние изменения</strong></p>
								<div style="background: url('{% static 'images/world-map.png' %} ') no-repeat center center; background-size: 100%;">
									<address>
										<abbr title="Email Address"><strong>Email:</strong></abbr> covidmonitor@gmail.com
									</address>
								</div>
							</div>
						</div>
						<div class="col_one_third">
							<div class="widget widget_links clearfix">
								<h4>Blogroll</h4>
								<ul>
									<li><a href="http://codex.wordpress.org/">Documentation</a></li>
									<li><a href="http://wordpress.org/support/forum/requests-and-feedback">Feedback</a></li>
									<li><a href="http://wordpress.org/extend/plugins/">Plugins</a></li>
									<li><a href="http://wordpress.org/support/">Support Forums</a></li>
								</ul>
							</div>
						</div>

						<div class="col_one_third col_last">

							<div class="widget clearfix">
								<h4>Источники информации</h4>
								<div id="post-list-footer">
									<div class="spost clearfix">
										<div class="entry-c">
											<div class="entry-title">
												<h4><a href="https://news.google.com/covid19/map?hl=ru&gl=RU&ceid=RU:ru">News Google</a></h4>
											</div>
										</div>
									</div>

									<div class="spost clearfix">
										<div class="entry-c">
											<div class="entry-title">
												<h4><a href="https://www.tut.by/">TUT.BY</a></h4>
											</div>
										</div>
									</div>

									<div class="spost clearfix">
										<div class="entry-c">
											<div class="entry-title">
												<h4><a href="https://coronavirus.jhu.edu/">CORONAVIRUS RESOURCE CENTER</a></h4>
											</div>

										</div>
									</div>
									<div class="spost clearfix">
										<div class="entry-c">
											<div class="entry-title">
												<h4><a href="http://minzdrav.gov.by/ru/">Минздрав РБ</a></h4>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col_one_third col_last">
						<div class="widget clearfix" style="margin-bottom: -20px;">
							<div class="row">
								<div class="col-lg-4 bottommargin-sm">
									<div class="counter counter-small"><span data-from="50" data-to="{{ facts_last.confirmed }}" data-refresh-interval="150" data-speed="3000" data-comma="true"></span></div>
									<h5 class="nobottommargin">Заболели</h5>
								</div>
								<div class="col-lg-4 bottommargin-sm">
									<div class="counter counter-small"><span data-from="550" data-to="{{ facts_last.recovered }}" data-refresh-interval="50" data-speed="3000" data-comma="true"></span></div>
									<h5 class="nobottommargin">Выздоровели</h5>
								</div>

								<div class="col-lg-4 bottommargin-sm">
									<div class="counter counter-small"><span data-from="5" data-to="{{ facts_last.deaths }} " data-refresh-interval="10" data-speed="3000" data-comma="true"></span></div>
									<h5 class="nobottommargin">Умерли</h5>
								</div>

							</div>

						</div>

						<div class="widget subscribe-widget clearfix">
							<h5><strong>Subscribe</strong> to Our Newsletter to get Important News, Amazing Offers &amp; Inside Scoops:</h5>
							<div class="widget-subscribe-form-result"></div>
							<form id="widget-subscribe-form" action="include/subscribe.php" role="form" method="post" class="nobottommargin">
								<div class="input-group divcenter">
									<div class="input-group-prepend">
										<div class="input-group-text"><i class="icon-email2"></i></div>
									</div>
									<input type="email" id="widget-subscribe-form-email" name="widget-subscribe-form-email" class="form-control required email" placeholder="Enter your Email">
									<div class="input-group-append">
										<button class="btn btn-success" type="submit">Subscribe</button>
									</div>
								</div>
							</form>
						</div>

						<div class="widget clearfix" style="margin-bottom: -20px;">

							<div class="row">

								<div class="col-lg-6 clearfix bottommargin-sm">
									<a href="#" class="social-icon si-dark si-colored si-facebook nobottommargin" style="margin-right: 10px;">
										<i class="icon-facebook"></i>
										<i class="icon-facebook"></i>
									</a>
									<a href="#"><small style="display: block; margin-top: 3px;"><strong>Like us</strong><br>on Facebook</small></a>
								</div>
								<div class="col-lg-6 clearfix">
									<a href="#" class="social-icon si-dark si-colored si-rss nobottommargin" style="margin-right: 10px;">
										<i class="icon-rss"></i>
										<i class="icon-rss"></i>
									</a>
									<a href="#"><small style="display: block; margin-top: 3px;"><strong>Subscribe</strong><br>to RSS Feeds</small></a>
								</div>

							</div>

						</div>

					</div>

				</div><!-- .footer-widgets-wrap end -->

			</div>

		</footer><!-- #footer end -->

	</div><!-- #wrapper end -->

	<!-- Go To Top
	============================================= -->
	<div id="gotoTop" class="icon-angle-up"></div>

	<!-- External JavaScripts
	============================================= -->
	<script src="{% static 'js/jquery.js' %} "></script>
	<script src="{% static 'js/plugins.js' %} "></script>

	<!-- Footer Scripts
	============================================= -->
	<script src="{% static 'js/functions.js' %} "></script>

<!-- Charts JS
	============================================= -->
	<script src="{% static 'js/chart.js' %} "></script>
	<script src="{% static 'js/chart-utils.js' %} "></script>
	<script src="{% static 'js/components/moment.js' %} "></script>

	<script>
		var endpoint = '/api/v1/facts/'
		var published_at = []
		var confirmed = []
		var recovered = []
		var deaths = []

		$.ajax({
			method: "GET",
			url: endpoint,
			success: function(data){
				for(var i=data.length-30; i < data.length; i++){
					d = new Date(data[i].published_at)
					published_at.unshift(d)
					confirmed.unshift(data[i].confirmed)
					recovered.unshift(data[i].recovered)
					deaths.unshift(data[i].deaths)
				}
				console.log(published_at);


			},
			error: function(error_data){
				console.log("error")
				console.log(error_data)
			}
		})

		var timeFormat = 'DD/MM';

		function newDate(days) {
			return moment().add(days, 'd').toDate();
		}

		function newDateString(days) {
			return moment().add(days, 'd').format(timeFormat);
		}

		function newTimestamp(days) {
			return moment().add(days, 'd').unix();
		}

		var color = Chart.helpers.color;
		var config = {
			type: 'line',
			data: {
				labels: published_at,
				datasets:
				[
					{
					label: "Заболели",
					backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
					borderColor: window.chartColors.red,
					fill: false,
					data: confirmed,
				},
				{
					label: "Выздоровели",
					backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
					borderColor: window.chartColors.green,
					fill: false,
					data: recovered,
				},
				{
					label: "Умерли",
					backgroundColor: color(window.chartColors.black).alpha(0.5).rgbString(),
					borderColor: window.chartColors.black,
					fill: false,
					data: deaths,
				}]
			},
			options: {
				title:{
					text: "Статистика COVID-19 в Беларуси"
				},
				scales: {
					xAxes: [{
						type: "time",
						time: {
							format: timeFormat,
							// round: 'day'
							tooltipFormat: 'DD/MM'
						},
						scaleLabel: {
							display: false,
							labelString: 'Дата'
						}
					}, ],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'Количество'
						}
					}]
				},
			}
		};
		const myChart = document.querySelectorAll('.animate-me');

		observer = new IntersectionObserver(entries => {
		entries.forEach(entry => {
			if (entry.intersectionRatio > 0) {
			console.log('in the view');
			var ctx = document.getElementById("chart-0").getContext("2d");
			window.myLine = new Chart(ctx, config);





			} else {
			console.log('out of view');
			}
		});
		});

		myChart.forEach(image => {
		observer.observe(image);
		});


	</script>
</body>
</html>
